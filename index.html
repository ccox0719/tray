const url = "https://ccox0719.github.io/tray/bible-study.json";

let currentDate = new Date();

function formatDate(date) {
  const options = { month: "long", day: "numeric" };
  return date.toLocaleDateString("en-US", options);
}

function loadDevotional(date) {
  fetch(url)
    .then(response => {
      if (!response.ok) {
        throw new Error(`HTTP error! Status: ${response.status}`);
      }
      return response.json(); // JSON is parsed here
    })
    .then(data => {
      const formattedDate = formatDate(date); // Format the date (e.g., "January 1")
      let study = null;

      // If the JSON is an array, use .find() to locate the matching entry
      if (Array.isArray(data)) {
        study = data.find(entry => entry.Date === formattedDate);
      }

      // If no matching date is found, display a default message
      if (!study) {
        study = {
          Reference: "No study found for this date.",
          Passage: "",
          Reflective Question: "",
          Prayer Prompt: ""
        };
      }

      // Update the page content
      document.getElementById("current-date").textContent = formattedDate;
      document.getElementById("reference").textContent = study.Reference;
      document.getElementById("passage").textContent = study.Passage;
      document.getElementById("reflection").innerHTML = `<strong>Reflective Question:</strong> ${study["Reflective Question"]}`;
      document.getElementById("prayer").innerHTML = `<strong>Prayer Prompt:</strong> ${study["Prayer Prompt"]}`;
    })
    .catch(error => {
      console.error("Error loading JSON:", error);
      document.getElementById("bible-study").innerHTML = `
        <p>Error loading data. Please try again later.</p>
      `;
    });
}

// Event Listeners for Buttons
document.getElementById("prev-day").addEventListener("click", () => {
  currentDate.setDate(currentDate.getDate() - 1); // Go to the previous day
  loadDevotional(currentDate);
});

document.getElementById("next-day").addEventListener("click", () => {
  currentDate.setDate(currentDate.getDate() + 1); // Go to the next day
  loadDevotional(currentDate);
});

// Load today's devotional on page load
loadDevotional(currentDate);
