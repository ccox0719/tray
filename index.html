const url = "https://ccox0719.github.io/tray/bible-study.json";

let currentDate = new Date();

function formatDate(date) {
  const options = { month: "long", day: "numeric" };
  return date.toLocaleDateString("en-US", options);
}

function loadDevotional(date) {
  fetch(url)
    .then(response => {
      if (!response.ok) {
        throw new Error(`HTTP error! Status: ${response.status}`);
      }
      return response.json();
    })
    .then(data => {
      const formattedDate = formatDate(date); // Format current date
      let study = null;

      // Iterate through the JSON to find the matching date
      for (const entry of Object.values(data)) {
        if (entry.Date === formattedDate) {
          study = entry;
          break;
        }
      }

      // If no matching date is found, display default message
      if (!study) {
        study = {
          Reference: "No study found for this date.",
          Passage: "",
          Reflective Question: "",
          Prayer Prompt: ""
        };
      }

      // Update the page content
      document.getElementById("current-date").textContent = formattedDate;
      document.getElementById("reference").textContent = study.Reference;
      document.getElementById("passage").textContent = study.Passage;
      document.getElementById("reflection").innerHTML = `<strong>Reflective Question:</strong> ${study["Reflective Question"]}`;
      document.getElementById("prayer").innerHTML = `<strong>Prayer Prompt:</strong> ${study["Prayer Prompt"]}`;
    })
    .catch(error => {
      console.error("Error loading JSON:", error);
      document.getElementById("bible-study").innerHTML = "<p>Error loading data. Please try again later.</p>";
    });
}

// Event Listeners for Buttons
document.getElementById("prev-day").addEventListener("click", () => {
  currentDate.setDate(currentDate.getDate() - 1);
  loadDevotional(currentDate);
});

document.getElementById("next-day").addEventListener("click", () => {
  currentDate.setDate(currentDate.getDate() + 1);
  loadDevotional(currentDate);
});

// Load today's devotional on page load
loadDevotional(currentDate);
